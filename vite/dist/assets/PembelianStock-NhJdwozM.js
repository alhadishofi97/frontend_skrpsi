import{e as r,j as t,J as p}from"./index-CSQcVwAp.js";import{M as j,a as d}from"./index-CSqU3jkE.js";import{S as _}from"./react-select.esm-u1LbiXjE.js";import{X as P}from"./index.es-CxZxsqlz.js";j.setAppElement("#root");const U=()=>{const[k,C]=r.useState([]),[l,u]=r.useState([{nama_barang:"",harga:"",qty:""}]),[v,b]=r.useState(!1),[f,w]=r.useState([]),[S,I]=r.useState(null);r.useState(null);const[m,B]=r.useState([]),[R,c]=r.useState(null);r.useState(!0);const[y,L]=r.useState(""),[s,D]=r.useState(""),[N,T]=r.useState([]);r.useEffect(()=>{(async()=>{const o={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};try{const n=await d.get("https://backendapi.my.id/api/pembelian/all-detail-pembelian",o);n.data?B(Array.isArray(n.data)?n.data:[n.data]):c("Data is not in expected format")}catch{c("Failed to fetch data")}})()},[]),r.useEffect(()=>{const a=async()=>{const n={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},x=await d.get("https://backendapi.my.id/api/supplier/all-supplier",n);C(x.data.data.map(i=>({value:i.id_supplier,label:i.nama_supplier})))},e=async()=>{const n={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},x=await d.get("https://backendapi.my.id/api/barang/all_barang",n);w(x.data.data.map(i=>({value:i.id_barang,label:i.nama_barang})))};a(),e()},[]);const A=()=>{b(!0)},g=()=>{b(!1)},E=()=>{u([...l,{nama_barang:"",harga:"",qty:""}])},M=a=>{const e=l.filter((o,n)=>n!==a);u(e)},h=(a,e,o)=>{const n=[...l];n[a][e]=o,u(n)},q=async()=>{const e={headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}};if(!S){c("Supplier harus dipilih");return}const o=l.map(n=>({id_nota:y,id_jenis_alur_barang:"1",id_supplier:S.value,id_barang:n.nama_barang,harga_beli:parseFloat(n.harga),quantity:parseInt(n.qty)}));try{const n=await d.post("https://backendapi.my.id/api/pembelian/create-pembelian",o,e);console.log("Response:",n.data),g()}catch(n){console.error("Error:",n),c("Failed to save data")}};r.useEffect(()=>{const a=m.filter(e=>e.id_nota&&e.id_nota.toLowerCase().includes(s.toLowerCase())||e.nama_supplier&&e.nama_supplier.toLowerCase().includes(s.toLowerCase())||e.nama_alur&&e.nama_alur.toLowerCase().includes(s.toLowerCase())||e.no_telp&&e.no_telp.toLowerCase().includes(s.toLowerCase())||e.alamat&&e.alamat.toLowerCase().includes(s.toLowerCase()));T(a)},[s,m]);const z=[{name:"ID Pembelian",selector:a=>a.id_pembelian,sortable:!0},{name:"ID Nota",selector:a=>a.id_nota,sortable:!0},{name:"Nama Alur",selector:a=>a.nama_alur,sortable:!0,wrap:!0},{name:"Nama Supplier",selector:a=>a.nama_supplier,sortable:!0,wrap:!0},{name:"Tanggal",selector:a=>new Date(a.created_at).toLocaleDateString(),sortable:!0},{name:"No. Telp",selector:a=>a.no_telp,sortable:!0},{name:"Alamat",selector:a=>a.alamat,sortable:!0}];return m.map(a=>({...a,nama_alur:a.nama_alur||"Unknown",nama_supplier:a.nama_supplier||"Unknown"})),t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:"10px"},children:t.jsx("input",{type:"text",placeholder:"Cari berdasarkan ID Nota, Nama Supplier, Nama Alur, No. Telp, atau Alamat",value:s,onChange:a=>D(a.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"}})}),t.jsx(p,{variant:"contained",marginBottom:"10px",onClick:A,children:"Tambah"}),t.jsx(P,{columns:z,data:N,pagination:!0}),t.jsxs(j,{isOpen:v,onRequestClose:g,contentLabel:"Tambah Pembelian",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"600px",padding:"20px"}},children:[t.jsx("h2",{children:"Tambah Pembelian Stock"}),t.jsxs("form",{children:[t.jsxs("div",{children:[t.jsx("label",{children:"ID Nota:"}),t.jsx("input",{type:"text",placeholder:"Masukkan ID Nota",value:y,onChange:a=>L(a.target.value),style:{marginBottom:"10px",padding:"8px",width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Supplier:"}),t.jsx(_,{options:k,onChange:I,placeholder:"Pilih Supplier"})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Barang:"}),l.map((a,e)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px"},children:[t.jsx(_,{options:f,placeholder:"Pilih Barang",value:f.find(o=>o.value===l[e].nama_barang)||null,onChange:o=>h(e,"nama_barang",o?o.value:""),style:{marginRight:"10px",padding:"8px",flex:1}}),t.jsx("input",{type:"text",placeholder:"Harga",value:a.harga,onChange:o=>h(e,"harga",o.target.value),style:{marginLeft:"10px",marginRight:"10px",padding:"8px",flex:1}}),t.jsx("input",{type:"text",placeholder:"Qty",value:a.qty,onChange:o=>h(e,"qty",o.target.value),style:{marginRight:"10px",padding:"8px",flex:1}}),t.jsx(p,{onClick:()=>M(e),style:{color:"red"},children:"X"})]},e)),t.jsx(p,{onClick:E,style:{marginTop:"10px"},children:"+ Tambah"})]})]}),t.jsx(p,{onClick:q,style:{padding:"10px",fontSize:"16px"},children:"Simpan"}),t.jsx(p,{onClick:g,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Batal"})]})]})};export{U as default};
