import{e as r,j as e,S as P,J as b}from"./index-Bg9J7LGO.js";import{a as g}from"./axios-BWYlR7gC.js";import{X as R}from"./index.es-CFrVd-4k.js";import{M as T}from"./index-D_v7NTKN.js";import{T as z,a as O,b as d,c as s,d as N,F as U,g as $}from"./index-BqCjO0uO.js";import{A as H}from"./Alert-B31wvcm5.js";T.setAppElement("#root");const Y=()=>{const[u,D]=r.useState([]),[S,x]=r.useState([]),[m,I]=r.useState({}),[l,_]=r.useState(""),[v,C]=r.useState(!0),[j,h]=r.useState(null),[E,k]=r.useState(!1),[a,F]=r.useState([]),L=()=>e.jsx(U,{icon:$});r.useEffect(()=>{const t=async()=>{const i={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};try{const n=await g.get("https://backendapi.my.id/api/transaksi/all_transaksi",i);if(n.data.status==="success")D(n.data.data),x(n.data.data);else throw new Error("Failed to fetch transaksi data")}catch(n){h(n.message)}finally{C(!1)}},o=async()=>{const i={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};try{const n=await g.get("https://backendapi.my.id/api/users/get_all_users",i);if(n.data.status==="success"){const M=n.data.data.reduce((y,w)=>(y[w.id_user]=w.name,y),{});I(M)}else throw new Error("Failed to fetch user data")}catch(n){h(n.message)}};t(),o()},[]),r.useEffect(()=>{const t=u.filter(o=>o.id_transaksi.toString().includes(l.toLowerCase())||o.nama.toLowerCase().includes(l.toLowerCase())||o.plat_motor.toLowerCase().includes(l.toLowerCase()));x(t)},[l,u]);const c=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),A=async t=>{const p={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};try{const i=await g.get(`https://backendapi.my.id/api/transaksi/invoice/${t.id_transaksi}`,p);if(i.data.status==="success")F(i.data.data),k(!0);else throw new Error("Failed to fetch invoice data")}catch(i){h(i.message)}},f=()=>{k(!1)},B=[{name:"ID Transaksi",selector:t=>t.id_transaksi,sortable:!0,width:"25%"},{name:"Nama",selector:t=>t.nama,sortable:!0},{name:"Plat Motor",selector:t=>t.plat_motor,sortable:!0},{name:"Tanggal",selector:t=>new Date(t.tanggal).toLocaleString(),sortable:!0,wrap:!0},{name:"Deskripsi",selector:t=>t.deskripsi,wrap:!0},{name:"Grand Total",selector:t=>c(t.grand_total),sortable:!0},{name:"Created By",selector:t=>m[t.id_user]||"Unknown",sortable:!0},{name:"Action",selector:t=>"Action",width:"250px",sortable:!1,cell:t=>e.jsx("div",{children:e.jsx(b,{variant:"outlined",onClick:()=>A(t),startIcon:e.jsx(L,{}),children:"View Detail"})})}];return e.jsxs("div",{children:[j&&e.jsx(H,{severity:"error",children:j}),e.jsx(P,{label:"Cari Transaksi Berdasarkan Nama atau Plat Motor",variant:"outlined",fullWidth:!0,margin:"normal",value:l,onChange:t=>_(t.target.value)}),e.jsx(R,{title:"Daftar Transaksi",columns:B,data:S,progressPending:v,pagination:!0}),e.jsxs(T,{isOpen:E,onRequestClose:f,contentLabel:"Invoice Modal",style:{content:{fontFamily:"Poppins",borderRadius:"20px",border:"2px solid gray",top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"30%",maxHeight:"80%",padding:"20px",overflowY:"auto",zIndex:1e3},overlay:{zIndex:999}},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"20px",fontFamily:"Poppins",fontSize:"30px"},children:e.jsx("strong",{children:"INVOICE"})}),a.length>0&&e.jsxs("div",{style:{marginBottom:"20px",fontFamily:"Poppins"},children:[e.jsxs("p",{children:["ID Transaksi: ",e.jsx("strong",{children:a[0].id_transaksi})]}),e.jsxs("p",{children:["Bill To: ",e.jsx("strong",{children:a[0].nama_kustomer})]}),e.jsxs("p",{children:["Plat Motor: ",e.jsx("strong",{children:a[0].plat_motor})]}),e.jsxs("p",{children:["Mekanik: ",e.jsx("strong",{children:a[0].nama_mekanik})]}),e.jsxs("p",{children:["Diagnosis: ",e.jsx("strong",{children:a[0].deskripsi})]}),e.jsxs("p",{children:["Jenis Layanan: ",e.jsx("strong",{children:a[0].jasa})]}),e.jsxs("p",{children:["Tanggal: ",e.jsx("strong",{children:new Date(a[0].tanggal).toLocaleDateString()})]}),e.jsxs("p",{children:["Dibuat oleh: ",e.jsx("strong",{children:m[a[0].nama_kasir]||"Unknown"})]}),e.jsxs(z,{children:[e.jsx(O,{children:e.jsxs(d,{children:[e.jsx(s,{children:"Deskripsi"}),e.jsx(s,{children:"Jumlah"}),e.jsx(s,{children:"Harga"}),e.jsx(s,{children:"Total"})]})}),e.jsxs(N,{children:[a.map((t,o)=>e.jsxs(d,{children:[e.jsx(s,{children:t.nama_barang}),e.jsx(s,{children:t.quantity}),e.jsx(s,{children:c(t.harga)}),e.jsx(s,{children:c(t.total)})]},o)),e.jsxs(d,{children:[e.jsx(s,{colSpan:3,align:"left",children:e.jsx("strong",{children:"Ongkos Service :"})}),e.jsx(s,{children:e.jsx("strong",{children:c(a[0].ongkos)})})]}),e.jsxs(d,{children:[e.jsx(s,{colSpan:3,align:"left",children:e.jsx("strong",{children:"Grand Total :"})}),e.jsx(s,{children:e.jsx("strong",{children:c(a[0].grand_total)})})]})]})]})]}),e.jsx(b,{onClick:f,color:"error",variant:"contained",children:"Close"})]})]})};export{Y as default};
