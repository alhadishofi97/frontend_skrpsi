import{e as r,j as e,J as c}from"./index-CSQcVwAp.js";import{M as S,a as w}from"./index-CSqU3jkE.js";import{X as Q}from"./index.es-CxZxsqlz.js";import{d as L}from"./Delete-bG8vH8l6.js";import{S as V,D as W,a as Y,b as Z,c as ee,d as te}from"./Snackbar-Dhc6b3TZ.js";import{A as ae}from"./Alert-CnTLrU2R.js";import{I as se}from"./IconPencil-fOTvrl4N.js";S.setAppElement("#root");const pe=()=>{const m=localStorage.getItem("token"),[h,f]=r.useState([]),[j,x]=r.useState([]),[M,b]=r.useState(!0),[k,D]=r.useState(null),[p,I]=r.useState(""),[y,U]=r.useState(!1),[O,E]=r.useState(!1),[o,C]=r.useState(null),[B,g]=r.useState(!1),[T,u]=r.useState(!1),[R,v]=r.useState(""),A=async()=>{try{const a=await(await fetch("https://backendapi.my.id/api/users/get_all_users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}})).json();a.status==="success"?(f(a.data),x(a.data)):D("Failed to fetch users")}catch{D("Error fetching data")}finally{b(!1)}};r.useEffect(()=>{A()},[]);const z=async()=>{b(!0),await A()};r.useEffect(()=>{const t=h.filter(a=>{var n,l,s;return((n=a.name)==null?void 0:n.toLowerCase().includes(p.toLowerCase()))||((l=a.email)==null?void 0:l.toLowerCase().includes(p.toLowerCase()))||((s=a.current_team)==null?void 0:s.toLowerCase().includes(p.toLowerCase()))});x(t)},[p,h]);const F=()=>{U(!0),setFormData({username:"",name:"",email:"",password:"",current_team_id:1,profile_photo_path:"/images/profile.jpg"})},N=t=>{C(t),E(!0)},$=t=>{C(t),g(!0)},P=async()=>{try{(await w.delete(`https://backendapi.my.id/api/users/delete/user/${o.id}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}})).data.status==="success"?(f(h.filter(a=>a.id!==o.id)),x(j.filter(a=>a.id!==o.id)),v("User deleted successfully"),u(!0)):alert("Failed to delete user")}catch(t){console.error("Error deleting user:",t),alert("Error deleting user")}finally{g(!1),C(null)}},G=()=>e.jsxs(W,{open:B,onClose:()=>g(!1),children:[e.jsx(Y,{children:"Delete Confirmation"}),e.jsx(Z,{children:e.jsxs(ee,{children:["Are you sure you want to delete ",o==null?void 0:o.name,"?"]})}),e.jsxs(te,{children:[e.jsx(c,{onClick:()=>g(!1),color:"primary",children:"Cancel"}),e.jsx(c,{onClick:P,color:"secondary",startIcon:e.jsx(L,{}),children:"Delete"})]})]});if(M)return e.jsx("div",{children:"Loading..."});if(k)return e.jsx("div",{children:k});const H=[{name:"ID",selector:t=>t.id_user,sortable:!0},{name:"Name",selector:t=>t.name?t.name:"N/A",sortable:!0},{name:"Email",selector:t=>t.email,sortable:!0},{name:"Username",selector:t=>t.username?t.username:"N/A",sortable:!0},{name:"Team",selector:t=>t.current_team,sortable:!0},{name:"Created At",selector:t=>t.created_at?t.created_at:"N/A",sortable:!0},{name:"Action",selector:t=>"Action",width:"250px",sortable:!1,format:t=>e.jsxs("div",{children:[e.jsx(c,{variant:"outlined",onClick:()=>N(t),style:{marginRight:"10px"},startIcon:e.jsx(se,{}),children:"Edit"}),e.jsx(c,{variant:"outlined",onClick:()=>$(t),startIcon:e.jsx(L,{}),children:"Delete"})]})}],q=()=>{const[t,a]=r.useState({username:"",name:"",email:"",password:"",current_team_id:"",profile_photo_path:"/images/profile.jpg"}),n=s=>{const{name:d,value:i}=s.target;a({...t,[d]:i})},l=async()=>{try{const s=await w.post("https://backendapi.my.id/api/users/create/user",t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}});if(s.data.status==="success"){const d=s.data.data;f([...h,d]),x([...j,d]),v("User created successfully"),u(!0),_()}else alert("Failed to create user")}catch(s){console.error("Error creating user:",s),alert("Error creating user")}};return e.jsxs(S,{isOpen:y,onRequestClose:_,contentLabel:"Create User",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"400px",padding:"20px"}},children:[e.jsx("h2",{children:"Create User"}),e.jsxs("form",{children:[e.jsx("input",{name:"username",placeholder:"Username",value:t.username,onChange:n,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"name",placeholder:"Name",value:t.name,onChange:n,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"email",placeholder:"Email",value:t.email,onChange:n,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"password",placeholder:"Password",type:"password",value:t.password,onChange:n,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsxs("select",{name:"current_team_id",value:t.current_team_id,onChange:s=>n({target:{name:"current_team_id",value:Number(s.target.value)}}),style:{width:"100%",marginBottom:"10px",padding:"8px"},children:[e.jsx("option",{value:"",children:"Pilih Role"}),e.jsx("option",{value:"1",children:"Administrator"}),e.jsx("option",{value:"2",children:"Staf Gudang"}),e.jsx("option",{value:"3",children:"Staf Kasir"}),e.jsx("option",{value:"4",children:"Staf Toko"}),e.jsx("option",{value:"5",children:"Mekanik"})]})]}),e.jsx("button",{onClick:l,style:{padding:"10px",fontSize:"16px"},children:"Save"}),e.jsx("button",{onClick:_,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Cancel"})]})},_=()=>{U(!y)},K=({user:t,onClose:a})=>{const[n,l]=r.useState({username:t.username,name:t.name,email:t.email,password:"",current_team_id:t.current_team_id,profile_photo_path:t.profile_photo_path}),s=i=>{const{name:X,value:J}=i.target;l({...n,[X]:J})},d=async()=>{try{(await w.put(`https://backendapi.my.id/api/users/update_user/${t.id_user}`,n,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}})).data.message==="User updated successfully"?(v("User updated successfully"),u(!0),a()):alert("Failed to update user")}catch(i){console.error("Error updating user:",i),alert("Error updating user")}};return e.jsxs(S,{isOpen:!0,onRequestClose:a,contentLabel:"Edit User",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"400px",padding:"20px"}},children:[e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{children:[e.jsx("input",{name:"username",placeholder:"Username",value:n.username,onChange:s,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"name",placeholder:"Name",value:n.name,onChange:s,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"email",placeholder:"Email",value:n.email,onChange:s,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"password",placeholder:"Password (leave blank to keep current)",type:"password",value:n.password,onChange:s,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsxs("select",{name:"current_team_id",value:n.current_team_id,onChange:i=>s({target:{name:"current_team_id",value:Number(i.target.value)}}),style:{width:"100%",marginBottom:"10px",padding:"8px"},children:[e.jsx("option",{value:"",children:"Pilih Role"}),e.jsx("option",{value:"1",children:"Administrator"}),e.jsx("option",{value:"2",children:"Staf Gudang"}),e.jsx("option",{value:"3",children:"Staf Kasir"}),e.jsx("option",{value:"4",children:"Staf Toko"}),e.jsx("option",{value:"5",children:"Mekanik"})]})]}),e.jsx("button",{onClick:d,style:{padding:"10px",fontSize:"16px"},children:"Update"}),e.jsx("button",{onClick:a,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Cancel"})]})};return e.jsxs("div",{children:[e.jsx("h1",{children:"Users List"}),e.jsx(c,{variant:"contained",onClick:()=>F(),style:{marginBottom:"20px"},children:"Create User"}),e.jsx(c,{onClick:z,variant:"contained",style:{marginBottom:"20px",marginLeft:"15px"},children:"Reload Data"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or team",value:p,onChange:t=>I(t.target.value),style:{marginBottom:"20px",padding:"10px",width:"100%"}}),e.jsx(Q,{columns:H,data:j,pagination:!0,highlightOnHover:!0,pointerOnHover:!0}),y&&e.jsx(q,{}),O&&o&&e.jsx(K,{user:o,onClose:()=>E(!1)}),B&&e.jsx(G,{}),e.jsx(V,{open:T,autoHideDuration:6e3,onClose:()=>u(!1),children:e.jsx(ae,{onClose:()=>u(!1),severity:"success",sx:{width:"100%"},children:R})})]})};export{pe as default};
