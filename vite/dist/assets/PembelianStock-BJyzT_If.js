import{e as o,j as n,J as c}from"./index-Bg9J7LGO.js";import{a as m}from"./axios-BWYlR7gC.js";import{M as v}from"./index-D_v7NTKN.js";import{S as k}from"./react-select.esm-D6SJPgA7.js";import{X as R}from"./index.es-CFrVd-4k.js";import"./floating-ui.dom-ChydN0Bm.js";v.setAppElement("#root");const Q=()=>{const[C,w]=o.useState([]),[p,g]=o.useState([{nama_barang:"",harga:"",qty:""}]),[I,_]=o.useState(!1),[y,D]=o.useState([]),[S,B]=o.useState(null);o.useState(null);const[d,h]=o.useState([]),[F,u]=o.useState(null);o.useState(!0);const[j,L]=o.useState(""),[i,N]=o.useState(""),[A,T]=o.useState([]);o.useEffect(()=>{(async()=>{const r={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};try{const t=await m.get("https://backendapi.my.id/api/pembelian/all-detail-pembelian",r);if(t.data){const s=Array.isArray(t.data)?t.data:[t.data];s.sort((l,f)=>l.id_pembelian-f.id_pembelian),h(s)}else u("Data is not in expected format")}catch{u("Failed to fetch data")}})()},[]),o.useEffect(()=>{const a=async()=>{const t={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},s=await m.get("https://backendapi.my.id/api/supplier/all-supplier",t);w(s.data.data.map(l=>({value:l.id_supplier,label:l.nama_supplier})))},e=async()=>{const t={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},s=await m.get("https://backendapi.my.id/api/barang/all_barang",t);D(s.data.data.map(l=>({value:l.id_barang,label:l.nama_barang})))};a(),e()},[]);const E=()=>{_(!0)},x=()=>{_(!1)},M=()=>{g([...p,{nama_barang:"",harga:"",qty:""}])},q=a=>{const e=p.filter((r,t)=>t!==a);g(e)},b=(a,e,r)=>{const t=[...p];t[a][e]=r,g(t)},z=async()=>{const e={headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}};if(!S){u("Supplier harus dipilih");return}const r=p.map(t=>({id_nota:j,id_jenis_alur_barang:"1",id_supplier:S.value,id_barang:t.nama_barang,harga_beli:parseFloat(t.harga),quantity:parseInt(t.qty)}));try{const t=await m.post("https://backendapi.my.id/api/pembelian/create-pembelian",r,e);if(console.log("Response:",t.data),Array.isArray(t.data)){const s=[...d,...t.data];s.sort((l,f)=>l.id_pembelian-f.id_pembelian),h(s)}else h(s=>[...s,t.data]);x()}catch(t){console.error("Error:",t),u("Failed to save data")}};o.useEffect(()=>{const a=d.filter(e=>e.id_nota&&e.id_nota.toLowerCase().includes(i.toLowerCase())||e.nama_supplier&&e.nama_supplier.toLowerCase().includes(i.toLowerCase())||e.nama_alur&&e.nama_alur.toLowerCase().includes(i.toLowerCase())||e.no_telp&&e.no_telp.toLowerCase().includes(i.toLowerCase())||e.alamat&&e.alamat.toLowerCase().includes(i.toLowerCase()));T(a)},[i,d]);const P=[{name:"ID Pembelian",selector:a=>a.id_pembelian,sortable:!0},{name:"ID Nota",selector:a=>a.id_nota,sortable:!0},{name:"Nama Alur",selector:a=>a.nama_alur,sortable:!0,wrap:!0},{name:"Nama Supplier",selector:a=>a.nama_supplier,sortable:!0,wrap:!0},{name:"Tanggal",selector:a=>{const e=new Date(a.created_at);return isNaN(e)?"Invalid Date":e.toLocaleDateString("id-ID")},sortable:!0},{name:"No. Telp",selector:a=>a.no_telp,sortable:!0},{name:"Alamat",selector:a=>a.alamat,sortable:!0}];return d.map(a=>({...a,nama_alur:a.nama_alur||"Unknown",nama_supplier:a.nama_supplier||"Unknown"})),n.jsxs("div",{children:[n.jsx("div",{style:{marginBottom:"10px"},children:n.jsx("input",{type:"text",placeholder:"Cari berdasarkan ID Nota, Nama Supplier, Nama Alur, No. Telp, atau Alamat",value:i,onChange:a=>N(a.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"}})}),n.jsx(c,{variant:"contained",marginBottom:"10px",onClick:E,children:"Tambah"}),n.jsx(R,{columns:P,data:A,pagination:!0}),n.jsxs(v,{isOpen:I,onRequestClose:x,contentLabel:"Tambah Pembelian",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"600px",padding:"20px"}},children:[n.jsx("h2",{children:"Tambah Pembelian Stock"}),n.jsxs("form",{children:[n.jsxs("div",{children:[n.jsx("label",{children:"ID Nota:"}),n.jsx("input",{type:"text",placeholder:"Masukkan ID Nota",value:j,onChange:a=>L(a.target.value),style:{marginBottom:"10px",padding:"8px",width:"100%"}})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Supplier:"}),n.jsx(k,{options:C,onChange:B,placeholder:"Pilih Supplier"})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Barang:"}),p.map((a,e)=>n.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px"},children:[n.jsx(k,{options:y,placeholder:"Pilih Barang",value:y.find(r=>r.value===p[e].nama_barang)||null,onChange:r=>b(e,"nama_barang",r?r.value:""),style:{marginRight:"10px",padding:"8px",flex:1}}),n.jsx("input",{type:"text",placeholder:"Harga",value:a.harga,onChange:r=>b(e,"harga",r.target.value),style:{marginLeft:"10px",marginRight:"10px",padding:"8px",flex:1}}),n.jsx("input",{type:"text",placeholder:"Qty",value:a.qty,onChange:r=>b(e,"qty",r.target.value),style:{marginRight:"10px",padding:"8px",flex:1}}),n.jsx(c,{onClick:()=>q(e),style:{color:"red"},children:"X"})]},e)),n.jsx(c,{onClick:M,style:{marginTop:"10px"},children:"+ Tambah"})]})]}),n.jsx(c,{onClick:z,style:{padding:"10px",fontSize:"16px"},children:"Simpan"}),n.jsx(c,{onClick:x,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Batal"})]})]})};export{Q as default};
